<!DOCTYPE html>
<html>
<head>
    <title>SMACCMPilot Heads Up Display</title>

    <!-- Bootstrap core CSS -->
    <link href="/bootstrap-3.3.4-dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="/bootstrap-3.3.4-dist/css/bootstrap-theme.min.css" rel="stylesheet">
</head>
<body role="document">

    <canvas id="pfd-view" width="500" height="350"></canvas>

    <canvas id="target-view"></canvas>

    <div id="status-view"></div>

    <div id="gyro-cal-progress">
      Gyro calibration:
      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="0"
             aria-valuemin="0" aria-valuemax="1" style="min-width: 2em">
          <span class="progress-bar-label">?</span>
        </div>
      </div>
    </div>

    <div id="mag-cal-progress">
      Mag calibration:
      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="0"
             aria-valuemin="0" aria-valuemax="1" style="min-width: 2em">
          <span class="progress-bar-label">?</span>
        </div>
      </div>
    </div>

    <div id="accel-cal-progress">
      Accel calibration:
      <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="0"
             aria-valuemin="0" aria-valuemax="1" style="min-width: 2em">
          <span class="progress-bar-label">?</span>
        </div>
      </div>
    </div>

    <div id="debug"></div>

    <script src="/underscore-1.8.3.js"></script>
    <script src="/jquery-2.1.3.js"></script>
    <script src="/backbone-1.1.2.js"></script>
    <script src="/bootstrap-3.3.4-dist/js/bootstrap.min.js"></script>
    <script src="/paper-core-0.9.15.js"></script>
    <script src="/scheduler.js"></script>
    <script src="/debug.js"></script>
    <script src="/uitest.js"></script>
    <script src="/bbox.js"></script>
    <script src="/pfd.js"></script>
<script>
$(function() {

var CameraTarget = Backbone.Model.extend({
  urlRoot: '/controllable_vehicle_i/camera_target_input'
});

var cameraTarget = new CameraTarget({});
var cameraTargetView = new BBoxView({ model: cameraTarget, el: '#target-view' });

// sensors_output valid/roll/pitch/yaw/baro_alt
// gps_output fix/num_sv/lat/lon/alt/vground

var SensorsOutput = Backbone.Model.extend({
  urlRoot: '/controllable_vehicle_i/sensors_output'
});
var sensorsOutput = new SensorsOutput({});
var pfdView = new PFDView({ model: sensorsOutput, el: '#pfd-view' });

var GPSOutput = Backbone.Model.extend({
  urlRoot: '/controllable_vehicle_i/gps_output'
});
var gpsOutput = new GPSOutput({});

// gyro_output_calibration.progress
// accel_output_calibration.progress
// mag_output_calibration.progress
// arming_status rcinput/telem/px4io/sens_cal
// control_law arming_mode; control_modes ui_mode/yaw_mode/thr_mode

var GyroCalibration = Backbone.Model.extend({
  urlRoot: '/controllable_vehicle_i/gyro_output_calibration'
});
var gyroCalibration = new GyroCalibration({});
var gyroCalibrationView = new UserInputSliderView({
  el: '#gyro-cal-progress',
  model: gyroCalibration,
  accessor: function (json) { return json.progress; },
});

var AccelCalibration = Backbone.Model.extend({
  urlRoot: '/controllable_vehicle_i/accel_output_calibration'
});
var accelCalibration = new AccelCalibration({});
var accelCalibrationView = new UserInputSliderView({
  el: '#accel-cal-progress',
  model: accelCalibration,
  accessor: function (json) { return json.progress; },
});

var MagCalibration = Backbone.Model.extend({
  urlRoot: '/controllable_vehicle_i/mag_output_calibration'
});
var magCalibration = new MagCalibration({});
var magCalibrationView = new UserInputSliderView({
  el: '#mag-cal-progress',
  model: magCalibration,
  accessor: function (json) { return json.progress; },
});

var ArmingStatus = Backbone.Model.extend({
  urlRoot: '/controllable_vehicle_i/arming_status'
});
var armingStatus = new ArmingStatus({});

var controlLaw = new ControlLaw({});

var controlLawView = new ControlLawView({ model: controlLaw, el: '#status-view' });
_.each(['rcinput', 'telem', 'px4io', 'sens_cal'], function (field) {
  $('#status-view').append(new ButtonGroupView({
    label: field,
    field: field,
    values: [ 'Negative', 'Neutral', 'Positive' ],
    model: armingStatus,
    writable: false,
  }).el);
});

var models = [
  cameraTarget,
  sensorsOutput,
  gpsOutput,
  gyroCalibration,
  accelCalibration,
  magCalibration,
  armingStatus,
  controlLaw,
];
new Scheduler({ period: 500 }, models);

_.each(models, function (m) {
  new JSONView({ model: m }).$el.appendTo('#debug');
});

});
</script>

</body>
</html>
